@model List<BaiTap_23WebC_Nhom10.Models.Product>
@using System.Globalization

<div class="product-carousel owl-carousel">
    @foreach (var p in Model)
    {
        var culture = new CultureInfo("vi-VN");
        var discountRate = p.discount / 100;
        var discountedPrice = p.price * (1 - discountRate);

        var formattedDiscountedPrice = string.Format(culture, "{0:C0}", discountedPrice).Replace("₫", "VNĐ");
        var formattedOriginalPrice = string.Format(culture, "{0:C0}", p.price).Replace("₫", "VNĐ");

        string mainImage = "/img/no-image.jpg";
        if (!string.IsNullOrWhiteSpace(p.image))
        {
            var images = p.image.Split(';', StringSplitOptions.RemoveEmptyEntries);
            if (images.Length > 0) mainImage = "/img/" + images[0].Trim();
        }

        <div class="single-product">
            <div class="product-f-image" style="height: 270px; overflow: hidden;">
                <a href="/product/detail/@p.id">
                    <img src="@mainImage" alt="@p.productName"
                         style="height: 100%; object-fit: contain; background-color:#ffffff;" />
                </a>
            </div>

            <h2 class="text-center" style="font-size:16px; height:48px; overflow:hidden; text-overflow:ellipsis; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;">
                <a asp-controller="Product" asp-action="Detail" asp-route-slug="@p.slug">@p.productName</a>
            </h2>

            <div class="product-carousel-price text-center">
                @if (p.discount > 0)
                {
                    <ins>@formattedDiscountedPrice</ins>
                    <del>@formattedOriginalPrice</del>
                }
                else
                {
                    <ins>@formattedOriginalPrice</ins>
                }
            </div>
        </div>
    }
</div>

@section js {
    <script>
        $(document).ready(function () {
            $('.product-carousel').owlCarousel({
                loop: true,
                nav: true,
                margin: 20,
                responsiveClass: true,
                responsive: {
                    0: { items: 1, nav: true },
                    600: { items: 3, nav: false },
                    1000: { items: 4, nav: true, loop: false }
                }
            });
        });
    </script>
}
